<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <style>
    body {
      padding: 100px;
      width: 1000px;
      margin: auto;
      text-align: center;
      align-items: center;
      text-align: center;
      justify-content: center;
      font-weight: 300;
      font-family: 'Futura', 'Playfair Display';
      color: #f4f4f4;
      background-color: rgb(21, 21, 21);
    }
    h1, h2, h3, h4 {
      font-family: 'Futura';
    }
    h2, h3, h4 {
      color: rgb(227, 227, 227);
      margin-top:5%;
    }
    img {
      align-items: center;
      justify-content: center;
      text-align: center;
    }
   
    p {
      font-family: 'Open Sans';
      font-size: 20px;
      color: rgb(209, 209, 209);
    }
    .center {
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }
    .centerimg {
      display:block;
      margin-left: auto;
      margin-right: auto;
    }
 
    code {
      background-color: rgb(73, 73, 73);
    }
    figcaption {
      font-family: 'Open Sans';
      color: rgb(209, 209, 209);
      font-size: 15px;
      text-align: center;
    }
   
   ol {
    font-family: 'Open Sans';
    color: rgb(209, 209, 209);
   }
   li p {
    margin-left: 30px;
   }
  
   li {
    text-align: left;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-top: 5%;
   }
  th, td {
    padding: 10px;
  }
  a {
    color:white;
  }
  html {
              scroll-behavior: smooth;
          }

    #references, li {
        margin-top: 1%;
    }
  
  </style>
<title>CS 184 Final Project Page</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">

<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

</head>


<body>

<h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2024</h1>
<h1 align="middle">Final Project: Steve Bobs MeshPainter 2.1 </h1>
<h2 align="middle">Rebecca Feng Khai Sam, Olivia Xie, and Mahum Khan</h2>
<p><a href="https://youtu.be/pad4RtW4Piw">Link to final video report</a></p>

<h2>Abstract</h2>
<p>
    We developed an interactive mesh painting interface in JavaScript. Users can
     create texture maps by painting directly onto 3D meshes in a viewer, or by 
     painting on UV coordinates in a separate drawing application window. Additionally,
      users can import their own meshes and texture maps, save their newly created textures,
       and generate default meshes for painting.
</p>

<p>
    Our platform offers a fast and simple user interface for texturing meshes, catering to quick
    and casual needs, unlike more complex solutions such as 3D Substance Painter or Blender, 
    used in a more professional context. We achieved this by leveraging front-end tools like 
    the Node.js environment, the Three.js API (which provides methods for creating a WebGL viewer,
     loading meshes, textures, raycasting, etc.), and the Canvas HTML element.
   
</p>
<h2> Technical Approach</h2>
<p>
    We broke our project down into several subparts:
    </p>
    <ol>
        <li>
            Creating a WebGL 3D mesh renderer that can handle texture mapping
            <p>
                We followed the ThreeJS documentation to render something on the 
                screen by setting up a WebGL viewer, a camera, lights, materials, 
                a mesh object, interactivity with the viewer, and set up a raycaster. 
                We also created a list of file paths that referred to a list of mesh 
                objects that we can load when the user presses “Generate Mesh.”
            </p>
        </li>
        <li>
            Creating a working drawing app
            <p>
                We expanded upon the <a href="https://www.youtube.com/watch?v=y84tBZo8GFo">code 
                from CodingNepal </a>for our drawing app. 
                This implementation is based on the HTML canvas element. Modifications we made 
                (other than the CSS styling) include displaying brush/eraser size as a circle 
                around the moving cursor and supporting texture import and UV display features. 
                We also fixed some details about the original drawing application such as smoother
                 lines and correct alignment of the brush on resized windows.

            </p>
        </li>
        <li>
            Combining the 3D renderer and drawing app for cross-functionality
            <p>
                ThreeJS supports the use of reading a texture file off of an HTML canvas element.
                 We utilized this to directly render a texture map onto our mesh from the drawing app. 
                 Because it would be costly to have to update the texture every frame, we chose to only
                update it when the user draws on the screen.
            </p>
        </li>
        <li>
            Importing and exporting mesh and texture files
            <p>
                To implement support for importing files, we began an instance of createElement('input').
                 This allowed us to define the type of file that we can import and what to do with the contents. 
                 Inside the function for the texture images, we mapped it onto the loaded mesh. For loading in a 
                 GTLF/GLB, the variables that define the mesh are adjusted to the new mesh that was imported. 

            </p>
        </li>
        <li>
            Implement raycasting in order to draw onto the mesh
            <p>
                This was one of the more challenging parts of the project. Upon researching
                 techniques on how to paint over meshes, we stumbled across a few resources.
                  <a href="https://tomtung.github.io/chameleon.js/">This demo </a> takes inspiration
                   from the <a href="http://www-ui.is.s.u-tokyo.ac.jp/~takeo/papers/i3dg2001.pdf">following paper</a>.
                    It dynamically creates and unwraps the UVs of a mesh so that painting
                   on the mesh is fast and efficient as opposed to drawing over a mesh that is already
                    UV unwrapped and static. However, the paper states that the limitations of this 
                    program can only be used to paint on meshes casually rather than for animated 
                    film or game assets, which require carefully-placed UVs from the start for texture
                     mapping and skinning. Thus, we decided to base our implementation by drawing on a 
                     static UV unwrapped mesh, because we wanted our program to mirror other professional 
                     3D paint programs and teach others how UV mapping works.

            </p>
            <p>
                The diagram below illustrates how we ended up implementing drawing directly onto
                 the mesh via raycasting. ThreeJS has its own raycaster class, and handles intersections
                  with faces on a mesh. Upon calling the intersect method, we can directly obtain the face
                   in which the mouse intersected, and its corresponding interpolated UV coordinates.
                    Once the UV coordinates are obtained, we can calculate their position on the drawing 
                    app by scaling with the corresponding width and height of the canvas. We scale (1-v) 
                    by the height instead of v because ThreeJS reads the top left UV coordinate as (0,0).

            </p>
            <img src="finalprojectimages/finalimages5.jpeg" width="700px" class="centerimg ">
            <figcaption >Our raycasting implementation on the banana mesh, a visualization</figcaption>
        </li>
    </ol>
<p>
    Along the way, we encountered various issues with our project that we had to solve. We highlight the
    two most prominent problems we successfully tackled below:
    <ul>
        <li></li>
        <li></li>
    </ul>

</p>

<h2>Results</h2>

<h2>References</h2>
<ul id="reference">
    <li>
        <a href="https://threejs.org/docs/index.html#manual/en/introduction/Creating-a-scene">
            ThreeJS Documentation
        </a></li>
    <li><a href="https://threejs.org/docs/#manual/en/introduction/Installation
        ">
        ThreeJS Getting Started
    </a></li>
    <li><a href=" https://www.youtube.com/watch?v=YK1Sw_hnm58" >
        Learn Three.js from Scratch: Crash Course Tutorial
    </a></li>
    <li><a href="https://www.youtube.com/watch?v=y84tBZo8GFo
        ">
        Build A Drawing or Paint App in HTML CSS & JavaScript | Drawing App in JavaScript
    </a></li>
    <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL_static">
        URL: createObjectURL() static method
    </a></li>
     <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">
        Canvas API
    </a></li>
    <li><a href="https://threejs.org/examples/?q=canvas#webgl_materials_texture_canvas" >
        webgl_materials_texture_canvas demo
    </a></li>
    <li><a href="https://threejs.org/examples/?q=raycast#webgl_instancing_raycast">
        webgl_instancing_raycast demo
    </a></li>
    <li><a href="https://stackoverflow.com/questions/67864724/threejs-load-gltf-model-directly-from-file-input">
        ThreeJS Load GLTF Model Directly From File Input
    </a></li>
    <li><a href="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js">
        WebGL Matrix and Vector Operations
    </a></li>
    <li><a href="https://javascript.info/promise-basics">
        Promise API
    </a></li>
    <li><a href="https://discourse.threejs.org/t/how-get-faces-triangle-data-from-buffergeometry/22906/2">
        How get faces( triangle ) data from buffergeometry
    </a></li>
    <li><a href="https://tomtung.github.io/chameleon.js/">
        Chameleon.js
    </a></li>
</ul>

<h2>Contributions from each team member</h2>
<ul>
    <li>
        Rebecca Feng:
        <p>
            Created the 3D WebGL interface and controls using the ThreeJS API,
             implemented cross-compatibility with the drawing app and 3D viewer
             , implemented raycasting and UV coordinate transformations for drawing
              on mesh directly, created the list of meshes to generate, implemented 
             the opacity slider, and attempted to UV map on the deprecated MeshEdit 
             version of our project. Also modeled the anime head.

        </p>
    </li>
    <li>
        Khai Sam:
        <p>
            Implemented promise handling for preloading assets, added a toggleable
             UV mesh layer for the canvas, did general debugging, and developed draw 
             code and import code in deprecated MeshEdit version.

        </p>
    </li>
    <li>
        Olivia Xie:
        <p>
            Implemented brush/erase, drawing app, website styling.

        </p>
    </li>
    <li>
        Mahum Khan:
        <p>
            Loading in gtlf/glb files, implementing imports so users can input their own 
            texture or models 

        </p>
    </li>
</ul>
</body>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</html>